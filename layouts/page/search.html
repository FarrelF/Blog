{{ define "body-class" }}template-search{{ end }}
{{ define "head" }}
    {{- with .OutputFormats.Get "json" -}} 
        <link rel="preload" href="{{ .Permalink }}" as="fetch" crossorigin="anonymous">
    {{- end -}}
{{ end }}
{{ define "main" }}
<form action="{{ .Permalink }}" class="search-form"{{ with .OutputFormats.Get "json" -}} data-json="{{ .Permalink }}"{{- end }}>
    <p>
        <label>{{ T "search.title" }}</label>
        <input name="keyword" placeholder="{{ T `search.placeholder` }}" />
    </p>

    <button title="{{ T `search.title` }}">
        {{ partial "helper/icon" "search" }}
    </button>
</form>

<h3 class="search-result--title section-title"></h3>
<div class="search-result--list article-list--compact"></div>

<script>
    window.searchResultTitleTemplate = "{{ T `search.resultTitle` }}"
</script>
{{- $Permalink := "" -}}
{{- $searchScript := "" -}}
{{- $opts := dict "JSXFactory" "createElement" -}}
{{- if eq hugo.IsProduction true -}}
    {{- $searchScript = resources.Get "ts/search.tsx" | js.Build $opts | minify | fingerprint "sha384" -}}
    {{- if .Site.Params.CDN.JS.URL -}}
        {{- $Permalink = printf "%s%s" $.Site.Params.CDN.JS.URL $searchScript.RelPermalink -}}
    {{- end -}}
{{- else -}}
    {{- $searchScript = resources.Get "ts/search.tsx" | js.Build $opts | fingerprint "sha384" -}}
{{- end -}}
{{- $Permalink := $searchScript.RelPermalink -}}
{{- if and (.Site.Params.CDN.JS.URL) (eq hugo.IsProduction true) -}}
    {{- $Permalink = printf "%s%s" $.Site.Params.CDN.JS.URL $searchScript.RelPermalink -}}
{{- end -}}
<script type="text/javascript" src="{{ $Permalink }}" integrity="{{ $searchScript.Data.Integrity }}" defer></script>

{{ partialCached "footer/footer" . }}
{{ end }}
